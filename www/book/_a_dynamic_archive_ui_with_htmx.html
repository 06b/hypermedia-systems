<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.18">
<meta name="author" content="Adam Stepinski, Carson Gross, Deniz Akşimşek">
<title>Building Hypermedia Systems</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<style>.toc-current{font-weight: bold;} .toc-root{font-family: "Open Sans","DejaVu Sans",sans-serif;
                       font-size: 0.9em;} #content{display: flex; flex-direction: column; flex: 1 1 auto;}
             .nav-footer{text-align: center; margin-top: auto;}
             .nav-footer > p > a {white-space: nowrap;}</style>
</head>
<body id="_a_dynamic_archive_ui_with_htmx" class="book">
<div id="header">
<h1>Building Hypermedia Systems</h1>
<div class="details">
<span id="author" class="author">Adam Stepinski, Carson Gross, Deniz Akşimşek</span><br>
</div>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<p><span class="toc-root"><a href="BuildingHypermediaSystems.html">Building Hypermedia Systems</a></span></p><ul class="sectlevel0">
<li><a href="_building_hypermedia_systems.html">Building Hypermedia Systems</a>
<ul class="sectlevel1">
<li><a href="_reintroducing_hypermedia.html">1. Reintroducing Hypermedia</a>
</li>
<li><a href="_rest_hateoas_and_all_that.html">2. REST, HATEOAS and All That</a>
</li>
<li><a href="_building_a_simple_web_1_0_application.html">3. Building A Simple Web 1.0 Application</a>
</li>
<li><a href="_extending_html_as_hypermedia.html">4. Extending HTML As Hypermedia</a>
</li>
<li><a href="_htmx_in_action.html">5. htmx In Action</a>
</li>
<li><a href="_building_hypermedia_systems_2.html">6. Building Hypermedia Systems</a>
</li>
<li><a href="_more_htmx_patterns.html">7. More htmx Patterns</a>
</li>
<li><a href="_building_hypermedia_systems_3.html">8. Building Hypermedia Systems</a>
</li>
<li><a href="_a_dynamic_archive_ui_with_htmx.html"><span class="toc-current">9. A Dynamic Archive UI With htmx</span></a>
<ul class="sectlevel2">
<li><a href="_a_dynamic_archive_ui_with_htmx.html#_a_dynamic_archive_ui">A Dynamic Archive UI</a>
<ul class="sectlevel3">
<li><a href="_a_dynamic_archive_ui_with_htmx.html#_ui_requirements">UI Requirements</a>
</li>
<li><a href="_a_dynamic_archive_ui_with_htmx.html#_beginning_our_implementation">Beginning Our Implementation</a>
</li>
<li><a href="_a_dynamic_archive_ui_with_htmx.html#_adding_the_post_end_point">Adding the POST End Point</a>
</li>
<li><a href="_a_dynamic_archive_ui_with_htmx.html#_conditionally_rendering_a_progress_ui">Conditionally Rendering A Progress UI</a>
</li>
</ul>
</li>
<li><a href="_a_dynamic_archive_ui_with_htmx.html#_polling">9.1. Polling</a>
<ul class="sectlevel3">
<li><a href="_a_dynamic_archive_ui_with_htmx.html#_using_polling_to_update_the_archive_ui">9.1.1. Using Polling To Update The Archive UI</a>
</li>
<li><a href="_a_dynamic_archive_ui_with_htmx.html#_downloading_the_result">9.1.2. Downloading The Result</a>
</li>
<li><a href="_a_dynamic_archive_ui_with_htmx.html#_downloading_the_completed_archive">9.1.3. Downloading The Completed Archive</a>
</li>
</ul>
</li>
<li><a href="_a_dynamic_archive_ui_with_htmx.html#_smoothing_things_out_animations_in_htmx">9.2. Smoothing Things Out: Animations in htmx</a>
<ul class="sectlevel3">
<li><a href="_a_dynamic_archive_ui_with_htmx.html#_the_settling_step_in_htmx">9.2.1. The "Settling" Step in htmx</a>
</li>
</ul>
</li>
<li><a href="_a_dynamic_archive_ui_with_htmx.html#_dismissing_the_download_ui">9.3. Dismissing The Download UI</a>
</li>
<li><a href="_a_dynamic_archive_ui_with_htmx.html#_an_alternative_ux_auto_download">9.4. An Alternative UX: Auto-Download</a>
</li>
<li><a href="_a_dynamic_archive_ui_with_htmx.html#_summary_6">9.5. Summary</a>
</li>
</ul>
</li>
<li><a href="_building_hypermedia_systems_4.html">10. Building Hypermedia Systems</a>
</li>
<li><a href="_deep_htmx.html">11. Deep htmx</a>
</li>
<li><a href="_hyperview_a_mobile_hypermedia.html">12. Hyperview: A Mobile Hypermedia</a>
</li>
<li><a href="_building_a_contacts_app_with_hyperview.html">13. Building a Contacts App With Hyperview</a>
</li>
<li><a href="_extending_the_hyperview_client.html">14. Extending the Hyperview Client</a>
</li>
<li><a href="_client_side_scripting.html">15. Client Side Scripting</a>
</li>
<li><a href="_building_hypermedia_systems_5.html">16. Building Hypermedia Systems</a>
</li>
<li><a href="_json_data_apis_hypermedia_driven_applications.html">17. JSON Data APIs &amp; Hypermedia Driven Applications</a>
</li>
<li><a href="_other_hypermedia_libraries_technologies.html">18. Other Hypermedia Libraries &amp; Technologies</a>
</li>
<li><a href="_conclusion_3.html">19. Conclusion</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_a_dynamic_archive_ui_with_htmx">9. A Dynamic Archive UI With htmx</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter covers</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Creating a dynamically updated download UI using hypermedia</p>
</li>
<li>
<p>Utilizing declarative polling to update content on an interval</p>
</li>
<li>
<p>Adding smooth animations to a progress bar</p>
</li>
<li>
<p>Triggering a file download with a response header</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_a_dynamic_archive_ui">A Dynamic Archive UI</h3>
<div class="paragraph">
<p>We&#8217;ve come a long way from a traditional web 1.0-style web application at this point: we&#8217;ve added active search, bulk
delete (with some nice animations) and a slew of other features.  We have also built a HyperView-based mobile application,
taking advantage of that mobile-native hypermedia.  Overall, we have reached a level of interactivity that most people
would assume requires some sort JavaScript framework for our application, but we&#8217;ve done nearly all of it with good old
hypermedia, plus a bit of hypermedia-compatible scripting on the side.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s look at how we can add a final, major feature to Contact.app: downloading an archive of our contacts.</p>
</div>
<div class="paragraph">
<p>From a hypermedia perspective, downloading a file isn&#8217;t exactly rocket science: using the HTTP <code>Content-Disposition</code>
response header, we can easily tell the browser to download and save a file to the local computer.  However, let&#8217;s
make this problem a bit more interesting: let&#8217;s add in the fact that the export can take a bit of time, from five
to ten seconds, or sometimes even longer, to complete.</p>
</div>
<div class="paragraph">
<p>This means if we implemented it as a normal HTTP request, driven by a link or a button, the user might sit, with
very little visual feedback, wondering if the download is actually happening, while the export is being run.  They might eve
n click the download control again, causing a <em>second</em> archive request.  Not good!</p>
</div>
<div class="paragraph">
<p>This is a classic problem in web app development.  When faced with potentially long-running process like this,
we ultimately have two options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When the user triggers the action, block until it is complete and then respond with the result</p>
</li>
<li>
<p>Start the action and return immediately</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Just blocking and waiting for the action to complete is certainly the easy way to handle it, but it is a pretty terrible
user experience.  If you&#8217;ve ever clicked on something in a web 1.0-style application and then had to sit there for
what seems like an eternity before anything happens, you&#8217;ve seen the results of this choice.</p>
</div>
<div class="paragraph">
<p>The second option, starting the action asynchronously (say, by creating a thread, or submitting it
to a job runner system) is much nicer from a user experience perspective: you can respond immediately and the user
doesn&#8217;t need to sit there wondering what&#8217;s going on.</p>
</div>
<div class="paragraph">
<p>But the question is, what do you respond <em>with</em>?  The job probably isn&#8217;t complete yet, so you can&#8217;t just provide a link
to the results, can you?</p>
</div>
<div class="paragraph">
<p>I have seen a few different "simple" approaches in this scenario:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Let the user know that the process has started and that they will be emailed a link to the completed process
results when it is finished</p>
</li>
<li>
<p>Let the user know that the process has started and recommend that they should manually (!!!) refresh the page to see the
status of the process</p>
</li>
<li>
<p>Let the user know that the process has started and automatically refresh the page every few seconds using some JavaScript</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All of these work.  But they all are a somewhat awkward user experience, are they?</p>
</div>
<div class="paragraph">
<p>What we&#8217;d <em>really</em> like in this scenario is something more like what you see when, for example, you download a large file via the
browser: a nice progress bar indicating where in the process you are, and, when the process is complete, a link to click immediately
to view the result of the process.</p>
</div>
<div class="paragraph">
<p>This may sound like something impossible to implement with hypermedia, and, frankly, we&#8217;ll need to push htmx pretty hard
to make this all work, but, when it is done, it won&#8217;t be <em>that</em> much code, and we will be able to achieve the user experience
we want for this archiving feature.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s get into it.</p>
</div>
<div class="sect3">
<h4 id="_ui_requirements">UI Requirements</h4>
<div class="paragraph">
<p>Before we dive into the implementation, let&#8217;s discuss in broad terms what our new UI should look like:  we want a button
in the application labeled "Download Contact Archive".  When a user clicks on that button, we want to replace that
button with a progress bar.  As the archive job progresses, we want to move the progress bar along.  When the
archive job is done, we want to show a link to the user to download the archive file.</p>
</div>
<div class="paragraph">
<p>In order to actually do the archiving, we are going to use a python class, <code>Archiver</code>, that implements all the
functionality that we need.  We aren&#8217;t going to go into the implementation details of the class, because that&#8217;s beyond
the scope of this book.  Let&#8217;s say that it was created by another developer, and it provides all the server-side behavior
necessary to produce a contact archive.</p>
</div>
<div class="paragraph">
<p>In particular, it gives us the following methods to work with:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>status()</code> - A string representing the status of the download, either <code>Waiting</code>, <code>Running</code> or <code>Complete</code></p>
</li>
<li>
<p><code>progress()</code> - A number between 0 and 1, indicating how much progress the archive job has made</p>
</li>
<li>
<p><code>run()</code> - Starts a new archive job (if the current status is <code>Waiting</code>)</p>
</li>
<li>
<p><code>reset()</code> - Cancels the current archive job, if any, and resets to the "Waiting" state</p>
</li>
<li>
<p><code>archive_file()</code> - The path to the archive file that has been created on the server, so we can send it to the client</p>
</li>
<li>
<p><code>get()</code> - A class method that lets us get the Archiver for the current user</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This is not a terribly complicated API, is it?  The only somewhat tricky aspect to the whole API is that the <code>run()</code> method
is <em>non-blocking</em>. This means that it does not <em>immediately</em> create the archive file, but rather it starts a background job
(as a thread) to do the actual archiving.  This can be confusing if you aren&#8217;t used to multithreading in code: you might
be expecting the <code>run()</code> method to "block", that is, to actually execute the entire export and only return when it is
finished.  But, if it did that, we wouldn&#8217;t be able to start the archive process and immediately render our desired
archive progress UI, would we?</p>
</div>
</div>
<div class="sect3">
<h4 id="_beginning_our_implementation">Beginning Our Implementation</h4>
<div class="paragraph">
<p>We now have everything we need to begin implementing our UI: a reasonable outline of what it is going to look like, and
the domain logic to support it.</p>
</div>
<div class="paragraph">
<p>So, in getting down to building the UI, the first thing I want to note is that the UI is largely self-contained: we
want to replace the button with the download progress bar, and then the link to download the results of the archive
process.  The fact that our archive user interface is all going to be within a specific part of the UI is a strong hint
that we want to create a new template to handle it.  Let&#8217;s call this template <code>archive_ui.html</code>.</p>
</div>
<div class="paragraph">
<p>Another thing that jumps out at me is that we are going to want to replace the entire download UI in multiple cases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When we start the download, we will want to replace the button with a progress bar</p>
</li>
<li>
<p>As the archive process proceeds, we will want to replace/update the progress bar</p>
</li>
<li>
<p>When the archive process completes, we will want to replace the progress bar with a download link</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Given we are going to be updating the UI in this way, it makes sense to have a good target for the updates.  So, let&#8217;s
wrap the entire UI in a <code>div</code> tag, and then use that <code>div</code> as the target for all our operations.</p>
</div>
<div class="paragraph">
<p>Here is the start of the template content for our new archive user interface:</p>
</div>
<div class="listingblock">
<div class="title">Listing 11. 96. Our Initial Archive UI Template</div>
<div class="content">
<pre class="highlight"><code class="language-html" data-lang="html">&lt;div id="archive-ui" hx-target="this"&lt;1&gt; hx-swap="outerHTML"&lt;2&gt;&gt;

&lt;/div&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>This div will be the target for all elements inside of it</p>
</li>
<li>
<p>Replace the entire div every time using <code>outerHTML</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Next, lets add that "Download Contact Archive" button to the <code>div</code>, which will kick off the archive-then-download
process.  Let&#8217;s use a <code>POST</code> to the path <code>/contacts/archive</code> to trigger the start of the process:</p>
</div>
<div class="listingblock">
<div class="title">Listing 11. 97. Adding The Button</div>
<div class="content">
<pre class="highlight"><code class="language-html" data-lang="html">&lt;div id="archive-ui" hx-target="this" hx-swap="outerHTML"&gt;
  &lt;button hx-post="/contacts/archive"&gt; <b class="conum">(1)</b>
      Download Contact Archive
  &lt;/button&gt;
&lt;/div&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>This button will issue a <code>POST</code> to <code>/contacts/archive</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Finally, let&#8217;s include this template in our main <code>index.html</code> template, above the contacts table:</p>
</div>
<div class="listingblock">
<div class="title">Listing 11. 98. Our Initial Archive UI Template</div>
<div class="content">
<pre class="highlight"><code class="language-html" data-lang="html">{% block content %}

    {% include 'archive_ui.html' %} <b class="conum">(1)</b>

    &lt;form action="/contacts" method="get" class="tool-bar"&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>This template will now be included in the main template</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>With that done, we now have a button showing up in our web application to get the download going.  Since the enclosing
<code>div</code> has an <code>hx-target="this"</code> on it, the button will inherit that target and replace the <code>div</code> with whatever HTML
comes back from the <code>POST</code> to <code>/contacts/archive</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_adding_the_post_end_point">Adding the POST End Point</h4>
<div class="paragraph">
<p>Our next step is to handle the <code>POST</code> that the button is making.  What we are going to want to do is to get the
<code>Archiver</code> for the current user and invoke the <code>run()</code> method on it.  This will start the archive process running.  Then
we will want to render some new content indicating that the process is running.</p>
</div>
<div class="paragraph">
<p>To do that, what we want to do is reuse the <code>archive_ui</code> template to handle rendering the archive UI for both states,
when the archiver is "Waiting" and when it is "Running".  (We will handle the "Complete" state in a bit.)</p>
</div>
<div class="paragraph">
<p>This is a very common pattern: we put all the different potential UIs for a given chunk of the user interface into
a single template, and conditionally render the appropriate interface.  By keeping everything in one file, it makes
it much easier for other developers (or for us, if we come back after a while!) to understand exactly how the UI
works on the client side.</p>
</div>
<div class="paragraph">
<p>Since we are going to conditionally render different user interfaces based on the state of the archiver, we will need
to pass the archiver out to the template as a parameter.  So, again: we need to invoke <code>run()</code> on the archiver in our
controller and then pass the archiver along to the template, so it can render the UI appropriate for the current
status of the archive process.</p>
</div>
<div class="paragraph">
<p>Here is what the code looks like:</p>
</div>
<div class="listingblock">
<div class="title">Listing 11. 99. Server Side Code To Start The Archive Process</div>
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">@app.route("/contacts/archive", methods=["POST"]) <b class="conum">(1)</b>
def start_archive():
    archiver = Archiver.get() <b class="conum">(2)</b>
    archiver.run() <b class="conum">(3)</b>
    return render_template("archive_ui.html", archiver=archiver) <b class="conum">(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Handle <code>POST</code> to <code>/contacts/archive</code></p>
</li>
<li>
<p>Look up the Archiver</p>
</li>
<li>
<p>Invoke the non-blocking <code>run()</code> method on it</p>
</li>
<li>
<p>Render the <code>archive_ui.html</code> template, passing in the archiver</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_conditionally_rendering_a_progress_ui">Conditionally Rendering A Progress UI</h4>
<div class="paragraph">
<p>Now let&#8217;s turn our attention to updating <code>archive_ui.html</code> to conditionally.  We are passing the archiver through
as a variable to the template, and recall that the archiver has a <code>status()</code> method that we can consult to see what
the status of the archive process.</p>
</div>
<div class="paragraph">
<p>We want to render the "Download Contact Archive" button if the archiver has the status <code>Waiting</code>, and we want to render
some sort of message indicating that progress is happening if the status is <code>Running</code>.  Let&#8217;s update our template code
to do just that:</p>
</div>
<div class="listingblock">
<div class="title">Listing 11. 100. Adding Conditional Rendering</div>
<div class="content">
<pre class="highlight"><code class="language-html" data-lang="html">&lt;div id="archive-ui" hx-target="this" hx-swap="outerHTML"&gt;
    {% if archiver.status() == "Waiting" %} <b class="conum">(1)</b>
        &lt;button hx-post="/contacts/archive"&gt;
            Download Contact Archive
        &lt;/button&gt;
    {% elif archiver.status() == "Running" %}<b class="conum">(2)</b>
       Running...<b class="conum">(3)</b>
    {% end %}

&lt;/div&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Only render button if the status is "Waiting"</p>
</li>
<li>
<p>Render different content when status is "Running"</p>
</li>
<li>
<p>For now, just some text saying things are Running</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>OK, great, we have some conditional logic in our template view, and the server side logic to support kicking off the
archive process.  We don&#8217;t have a progress bar yet, but we&#8217;ll get there!  Let&#8217;s see how this works as it stands, and
refresh the main page of our application&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="title">Listing 11. 101. Something Went Wrong</div>
<div class="content">
<pre class="highlight"><code class="language-" data-lang="">UndefinedError
jinja2.exceptions.UndefinedError: 'archiver' is undefined</code></pre>
</div>
</div>
<div class="paragraph">
<p>Ouch!</p>
</div>
<div class="paragraph">
<p>We get an error message right out of the box.  Why?  Ah, of course, we are including the <code>archive_ui.html</code> in the
<code>index.html</code> template, but now the <code>archive_ui.html</code> template expects the archiver to be passed through to it, so
it can conditionally render the correct UI.  Well, that&#8217;s an easy fix: we just need to pass the archiver through
when we render the <code>index.html</code> template as well:</p>
</div>
<div class="listingblock">
<div class="title">Listing 11. 102. Including The Archiver When We Render index.html</div>
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">@app.route("/contacts")
def contacts():
    search = request.args.get("q")
    if search is not None:
        contacts_set = Contact.search(search)
        if request.headers.get('HX-Trigger') == 'search':
            return render_template("rows.html", contacts=contacts_set)
    else:
        contacts_set = Contact.all()
    return render_template("index.html", contacts=contacts_set, archiver=Archiver.get())<b class="conum">(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Pass through archiver to the main template</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Now with that done, we can load up the page.  And, sure enough, we can see the "Download Contact Archive" button now!
When we click on it, the button is replaced with the content "Running&#8230;&#8203;", and we can see in our development console
on the server side that the job is indeed getting kicked off properly.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_polling">9.1. Polling</h3>
<div class="paragraph">
<p>That&#8217;s definitely progress, but we don&#8217;t exactly have the best progress indicator here: just some static text telling
the user that the process is running!</p>
</div>
<div class="paragraph">
<p>What we want to do is have the content update as the process makes progress and, ideally, show a progress bar indicating
how far along it is.  How can we do that in htmx using plain old hypermedia?</p>
</div>
<div class="paragraph">
<p>The technique we want to use here is called "polling", where we issue a request on an interval and update the UI based
on the new state of the server.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Polling?  Really?</div>
<div class="paragraph">
<p>Polling has a bit of a bad rap, and it isn&#8217;t the sexiest technique in the world: today
developers might look at a more advanced technique like WebSockets or Server Sent Events (SSE) to address this situation.</p>
</div>
<div class="paragraph">
<p>But, say what one will, polling <em>works</em> and it is drop-dead simple.  You need to be careful to make sure you don&#8217;t overwhelm
you system with polling requests, but, with a bit of care, you can create a reliable, passively updated component in
your UI.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>htmx offers two types of polling.  The first is "fixed rate polling", which uses a special <code>hx-trigger</code> syntax to indicate
that something should be polled on a fixed interval.</p>
</div>
<div class="paragraph">
<p>Here is an example:</p>
</div>
<div class="listingblock">
<div class="title">Listing 11. 103. Fixed Interval Polling</div>
<div class="content">
<pre class="highlight"><code class="language-html" data-lang="html">&lt;div hx-get="/messages" hx-trigger="every 3s"&gt; <b class="conum">(1)</b>
&lt;/div&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>trigger a <code>GET</code> to <code>/messages</code> every three seconds</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This works great in situations when you want to poll indefinitely, for example if you want to constantly poll for new
messages to display to the user.  However, fixed rate polling isn&#8217;t ideal when you have a definite process after which
you want to stop polling: it keeps polling forever, until the element it is on is removed from the DOM.</p>
</div>
<div class="paragraph">
<p>In our case, we have a definite process with an ending to it.  So, in our case, it will be better to use the other polling
technique, known as "load polling".  In load polling, you take advantage of the fact that htmx triggers a <code>load</code> event
when content is loaded into the DOM.  So you can create a trigger on the <code>load</code> event, but then add a bit of a delay so that
the request doesn&#8217;t trigger immediately.</p>
</div>
<div class="paragraph">
<p>If you do this, then you can conditionally render the <code>hx-trigger</code> on every request: when a process has completed you
can simply not include the trigger and the load polling stops.  A nice and simple way to poll for until a definite
process finishes.</p>
</div>
<div class="sect3">
<h4 id="_using_polling_to_update_the_archive_ui">9.1.1. Using Polling To Update The Archive UI</h4>
<div class="paragraph">
<p>So, let&#8217;s use load polling now to update our UI as the archiver makes progress.  To show the progress, let&#8217;s use
a CSS-based progress bar, taking advantage of the <code>progress()</code> method which returns a number between 0 and 1 indicating
how close the archive process is to completion.  Here is the snippet of HTML we will use:</p>
</div>
<div class="listingblock">
<div class="title">Listing 11. 104. A CSS-based Progress Bar</div>
<div class="content">
<pre class="highlight"><code class="language-html" data-lang="html">&lt;div class="progress" &gt;
    &lt;div class="progress-bar" style="width:{{ archiver.progress() * 100 }}%"&gt;&lt;/div&gt; <b class="conum">(1)</b>
&lt;/div&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The width of the inner element corresponds to the progress</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This CSS-based progress bar has two components: an outer <code>div</code> that provides the wire frame for the progress bar, and
 and inner <code>div</code> that is the actual progress bar indicator.  We set the width of the inner progress bar to some percentage
(note we need to multiply the <code>progress()</code> result by 100 to get a percentage) and that will make the progress
indicator the appropriate width within the parent div.</p>
</div>
<div class="paragraph">
<p>As I have mentioned before, this is not a book on CSS, but, for completeness, here is the CSS for this progress bar:</p>
</div>
<div class="listingblock">
<div class="title">Listing 11. 105. The CSS For Our Progress Bar</div>
<div class="content">
<pre class="highlight"><code class="language-css" data-lang="css">.progress {
    height: 20px;
    margin-bottom: 20px;
    overflow: hidden;
    background-color: #f5f5f5;
    border-radius: 4px;
    box-shadow: inset 0 1px 2px rgba(0,0,0,.1);
}

.progress-bar {
    float: left;
    width: 0%;
    height: 100%;
    font-size: 12px;
    line-height: 20px;
    color: #fff;
    text-align: center;
    background-color: #337ab7;
    box-shadow: inset 0 -1px 0 rgba(0,0,0,.15);
    transition: width .6s ease;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Which ends up rendering like this:</p>
</div>
<div id="figure-8-1" class="imageblock">
<div class="content">
<img src="../images/screenshot_progress_bar.png" alt="screenshot progress bar">
</div>
<div class="title">Figure 11. 10. Our CSS-Based Progress Bar</div>
</div>
<div class="paragraph">
<p>So let&#8217;s add the code for our progress bar into our <code>archive_ui.html</code> template for the case when the archiver is
running, and let&#8217;s update the copy to say "Creating Archive&#8230;&#8203;":</p>
</div>
<div class="listingblock">
<div class="title">Listing 11. 106. Adding The Progress Bar</div>
<div class="content">
<pre class="highlight"><code class="language-html" data-lang="html">&lt;div id="archive-ui" hx-target="this" hx-swap="outerHTML"&gt;
    {% if archiver.status() == "Waiting" %}
        &lt;button hx-post="/contacts/archive"&gt;
            Download Contact Archive
        &lt;/button&gt;
    {% elif archiver.status() == "Running" %}
        &lt;div&gt;
            Creating Archive...
            &lt;div class="progress" &gt; <b class="conum">(1)</b>
                &lt;div class="progress-bar" style="width:{{ archiver.progress() * 100 }}%"&gt;&lt;/div&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    {% endif %}
&lt;/div&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Our shiny new progress bar</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Sweet, now when we click the "Download Contact Archive" button, we get the progress bar.  But it still doesn&#8217;t update
because we haven&#8217;t implemented load polling yet!  It just sits there, at zero.</p>
</div>
<div class="paragraph">
<p>To get the UI we want, we&#8217;ll need to implement load polling using <code>hx-trigger</code>.  We can add this to pretty much
any element inside the conditional block for when the archiver is running, so let&#8217;s add it to that <code>div</code> that is
wrapping around the "Creating Archive&#8230;&#8203;" text and the progress bar.  Finally, let&#8217;s make it poll by issuing a
<code>GET</code> to the same path that the <code>POST</code> was issued too: <code>/contacts/archive</code>.  (As you have probably notices, this is a
common pattern in RESTful systems: reusing the same path with different actions.)</p>
</div>
<div class="listingblock">
<div class="title">Listing 11. 107. Implementing Load Polling</div>
<div class="content">
<pre class="highlight"><code class="language-html" data-lang="html">&lt;div id="archive-ui" hx-target="this" hx-swap="outerHTML"&gt;
    {% if archiver.status() == "Waiting" %}
        &lt;button hx-post="/contacts/archive"&gt;
            Download Contact Archive
        &lt;/button&gt;
    {% elif archiver.status() == "Running" %}
        &lt;div hx-get="/contacts/archive" hx-trigger="load delay:500ms"&gt; <b class="conum">(1)</b>
            Creating Archive...
            &lt;div class="progress" &gt;
                &lt;div class="progress-bar" style="width:{{ archiver.progress() * 100 }}%"&gt;&lt;/div&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    {% endif %}
&lt;/div&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Issue a <code>GET</code> to <code>/contacts/archive</code> 500 milliseconds after the content loads</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Again, it is important to realize that, when this <code>GET</code> is issued to <code>/contacts/archive</code>, it is going to replace
the <code>div</code> with the id <code>archive-ui</code>, not just itself.  The <code>hx-target</code> attribute is <em>inherited</em> by all child elements
within the <code>archive-ui</code> <code>div</code>, so, unless it is explicitly overriden by a child, the children will all target that
outermost <code>div</code> in the <code>archive_ui.html</code> file.</p>
</div>
<div class="paragraph">
<p>OK, now we need to handle the <code>GET</code> to <code>/contacts/archive</code> on the server.  Thankfully, this is quite easy: all we
want to do is re-render <code>archive_ui.html</code> with the archiver:</p>
</div>
<div class="listingblock">
<div class="title">Listing 11. 108. Handling Progress Updates</div>
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">@app.route("/contacts/archive", methods=["GET"]) <b class="conum">(1)</b>
def archive_status():
    archiver = Archiver.get()
    return render_template("archive_ui.html", archiver=archiver) <b class="conum">(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>handle <code>GET</code> to the <code>/contacts/archive</code> path</p>
</li>
<li>
<p>just re-render the <code>archive_ui.html</code> template</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Simple, like so much else with hypermedia!</p>
</div>
<div class="paragraph">
<p>And now, when we click the "Download Contact Archive", sure enough, we get a progress bar that updates every 500
milliseconds!  And, as the result of the call to <code>archiver.progress()</code> incrementally updates from 0 to 1, the
progress bar moves across the screen for us, very cool!</p>
</div>
</div>
<div class="sect3">
<h4 id="_downloading_the_result">9.1.2. Downloading The Result</h4>
<div class="paragraph">
<p>OK, we have one more state to handle, the case when <code>achiver.status()</code> is set to "Complete", and there is a JSON
archive of the data ready to download.  When the archiver is complete, we can get the local JSON file on the server
from the archiver via the <code>archive_file()</code> call.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s add another case to our if statement to handle the "Complete" state, and, when the archive job is complete, lets
render a link to a new path, <code>/contacts/archive/file</code>, which will respond with the archived JSON file.  Here is
the new code:</p>
</div>
<div class="listingblock">
<div class="title">Listing 11. 109. Rendering A Download Link When Archiving Completes</div>
<div class="content">
<pre class="highlight"><code class="language-html" data-lang="html">&lt;div id="archive-ui" hx-target="this" hx-swap="outerHTML"&gt;
    {% if archiver.status() == "Waiting" %}
        &lt;button hx-post="/contacts/archive"&gt;
            Download Contact Archive
        &lt;/button&gt;
    {% elif archiver.status() == "Running" %}
        &lt;div hx-get="/contacts/archive" hx-trigger="load delay:500ms"&gt;
            Creating Archive...
            &lt;div class="progress" &gt;
                &lt;div class="progress-bar" style="width:{{ archiver.progress() * 100 }}%"&gt;&lt;/div&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    {% elif archiver.status() == "Complete" %} <b class="conum">(1)</b>
        &lt;a hx-boost="false" href="/contacts/archive/file"&gt;Archive Ready!  Click here to download. &amp;downarrow;&lt;/a&gt; <b class="conum">(2)</b>
    {% endif %}
&lt;/div&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>If the status is "Complete", render a download link</p>
</li>
<li>
<p>The link will issue a <code>GET</code> to <code>/contacts/archive/file</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Note that the link has a <code>hx-boost</code> set to <code>false</code>.  It has this so that the link will not inherit the boost behavior
that is present for other links and, thus, will not be issued via AJAX.  We want this "normal" link behavior because an
AJAX request cannot download a file directly, whereas a plain anchor tag can.</p>
</div>
</div>
<div class="sect3">
<h4 id="_downloading_the_completed_archive">9.1.3. Downloading The Completed Archive</h4>
<div class="paragraph">
<p>The final step is to handle the <code>GET</code> request to <code>/contacts/archive/file</code>.  We want to send the file that the
archiver created down to the client.  We are in luck: flask has a very simple mechanism for sending a file as
a downloaded response: the <code>send_file()</code> method.</p>
</div>
<div class="paragraph">
<p>We can pass this method the path to the archive file that the archiver
created, the name of the file that we want the browser to create, and if we want it sent "as an attachment".
This last argument will which will tell Flask to set the  HTTP response header <code>Content-Disposition</code> to <code>attachment</code>
with the given filename, which will trigger the browsers file-downloading behavior.</p>
</div>
<div class="listingblock">
<div class="title">Listing 11. 110. Sending A File To The Client</div>
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">@app.route("/contacts/archive/file", methods=["GET"])
def archive_content():
    manager = Archiver.get()
    return send_file(manager.archive_file(), "archive.json", as_attachment=True) <b class="conum">(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>send the file to the client</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Perfect!  Now we have an archive UI that is pretty darned slick:  You can click the button and a progress bar appears.  When
the progress bar reaches 100%, it disappears and a link to download the archive file appears.  The user can then
click on that link and download their archive!</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_smoothing_things_out_animations_in_htmx">9.2. Smoothing Things Out: Animations in htmx</h3>
<div class="paragraph">
<p>As cool as this UI is, there is one minor annoyance with it: as the progress bar updates it "jumps" from one position
to the next.  This looks jerky and is reminiscent of the feel of a full page refresh in web 1.0 style applications.  It
turns out that there is a native HTML technology for smoothing out changes on an element from one state to another
that we discussed in Chapter 5: the CSS Transitions API.</p>
</div>
<div class="paragraph">
<p>Using CSS Transitions, you can smoothly animate an element between different styling by using the <code>transition</code> property.</p>
</div>
<div class="paragraph">
<p>If you look back at our CSS definition of the <code>.progress-bar</code> class, you will see the following transition definition
in it: <code>transition: width .6s ease;</code>.  This means that when the width of the progress bar is changed from, say 20% to
30%, the browser will animate over a period of .6 seconds using the "ease" function (which has a nice accelerate/decelerate
effect).</p>
</div>
<div class="paragraph">
<p>That&#8217;s great and all, but in our example, htmx is <em>replacing</em> the content with new content.  It isn&#8217;t updating the width
of the <em>existing</em> element, which would trigger a transition.  Rather, it is simply replacing it with a new element.  So
no transition will occur, which is, indeed, what we are seeing: the progress bar jumps from spot to spot as it moves
towards completion.</p>
</div>
<div class="sect3">
<h4 id="_the_settling_step_in_htmx">9.2.1. The "Settling" Step in htmx</h4>
<div class="paragraph">
<p>When we discussed the htmx swap model in Chapter 5, we focused on the classes that htmx adds and removes, but we skipped
over the idea of "settling".  What is "settling" in htmx terms?  Settling is the following process:  when htmx is
about to replace a chunk of content, it looks through the new content and finds all elements with an <code>id</code> on it.  It then
looks in the <em>existing</em> content for elements with the same <code>id</code>.  If there is one, it does the following shuffle:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <em>new</em> content gets the attributes of the <em>old</em> content temporarily</p>
</li>
<li>
<p>The new content is inserted</p>
</li>
<li>
<p>After a small delay, the new content has its attributes reverted to their actual values</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>So, what is this strange little dance supposed to achieve?  Well, what this ends up meaning is that, if an element
has a stable id between swaps, you <em>can</em> write CSS transitions between various states.  Since the new content briefly
has the <em>old</em> attributes, the normal CSS mechanism will kick in when the actual values are restored.</p>
</div>
<div class="paragraph">
<p>So, in our case, all we need to do is to add a stable ID to our <code>progress-bar</code> element, and, rather than jumping
on every update, it the progress bar should smoothly move across the screen as it is updating, using the CSS transition
defined in our style sheet:</p>
</div>
<div class="listingblock">
<div class="title">Listing 11. 111. Smoothing Things Out</div>
<div class="content">
<pre class="highlight"><code class="language-html" data-lang="html">&lt;div class="progress" &gt;
    &lt;div id="archive-progress" class="progress-bar" style="width:{{ archiver.progress() * 100 }}%"&gt;&lt;/div&gt; <b class="conum">(1)</b>
&lt;/div&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The progress bar div now has a stable id across requests</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>So, despite all the complicated mechanics going on behind the scenes in htmx, all we have to do, as an htmx user,
is add a simple <code>id</code> attribute to the element we want to animate.  And, viola, nice, smooth progress bar, even though
we are replacing the content with new HTML!</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_dismissing_the_download_ui">9.3. Dismissing The Download UI</h3>
<div class="paragraph">
<p>Next, let&#8217;s make it possible for the user to dismiss the download link and return to the original export UI state.  To
do this, we&#8217;ll add a button that issues a <code>DELETE</code> to the path <code>/contacts/archive</code>, indicating that the current archive
can be removed or cleaned up.</p>
</div>
<div class="paragraph">
<p>We&#8217;ll add it after the download link, like so:</p>
</div>
<div class="listingblock">
<div class="title">Listing 11. 112. Clearing The Download</div>
<div class="content">
<pre class="highlight"><code class="language-html" data-lang="html">    &lt;a hx-boost="false" href="/contacts/archive/file" _="on load click() me"&gt;Archive Ready!  Click here to download. &amp;downarrow;&lt;/a&gt;
    &lt;button hx-delete="/contacts/archive"&gt;Clear Download&lt;/button&gt; <b class="conum">(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>A simple button that issues a <code>DELETE</code> to <code>/contacts/archive</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Now the user has a button that they can click on to dismiss the archive download link.  But we will need to hook it up
on the server side.  As usual, this is pretty straight forward: we simply create a new handler for the <code>DELETE</code> HTTP Action,
invoke the <code>reset()</code> method on the archiver, and re-render the <code>archive_ui.html</code> template.  Since this button is
picking up the same <code>hx-target</code> and <code>hx-swap</code> configuration as everything else, it "just works".</p>
</div>
<div class="paragraph">
<p>Here is the server side code:</p>
</div>
<div class="listingblock">
<div class="title">Listing 11. 113. Resetting The Download</div>
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">@app.route("/contacts/archive", methods=["DELETE"])
def reset_archive():
    archiver = Archiver.get()
    archiver.reset() <b class="conum">(1)</b>
    return render_template("archive_ui.html", archiver=archiver)</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Call <code>reset()</code> on the archiver</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Looks pretty similar to our other methods, doesn&#8217;t it?  That&#8217;s the idea!</p>
</div>
</div>
<div class="sect2">
<h3 id="_an_alternative_ux_auto_download">9.4. An Alternative UX: Auto-Download</h3>
<div class="paragraph">
<p>While I prefer the current user experience for archiving contancts, where a progress bar shows the progress of
the process and, when it completes, I am given a new hypermedia control to actually download the file, there are other
alternatives to it.  Another pattern that I see on the web is "auto-downloading": rather than requiring the user to
click an additional button or link when the archive (or other process) is complete, instead the system automatically
downloads the file without any additional user interaction.</p>
</div>
<div class="paragraph">
<p>We can add this functionality quite easily to our application with just a bit of scripting.  We will use hyperscript
because it is our preferred scripting option, but the equivalent JavaScript should be obvious.</p>
</div>
<div class="paragraph">
<p>All we need to do to implement this auto-download feature is the following: when the download link renders,
simply automatically click on the link for the user.</p>
</div>
<div class="paragraph">
<p>The hyperscript will read basically just like that sentence:</p>
</div>
<div class="listingblock">
<div class="title">Listing 11. 114. Auto-Downloading</div>
<div class="content">
<pre class="highlight"><code class="language-html" data-lang="html">  &lt;a hx-boost="false" href="/contacts/archive/file"
     _="on load click() me"&gt; <b class="conum">(1)</b>
    Archive Downloading!  Click here if the download does not start.
  &lt;/a&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>a bit of hyperscript to make the file auto-download</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Have we mentioned that we like hyperscript?</p>
</div>
<div class="paragraph">
<p>Note, once again, that the scripting here is simply <em>enhancing</em> the existing hypermedia, rather than replacing it with
a non-hypermedia request.  This is hypermedia-friendly scripting!</p>
</div>
<div class="paragraph">
<p>So, despite our initial trepidation that it could be done, we&#8217;ve managed to create a very dynamic UI for our archive
functionality, with a progress bar and auto-downloading, and we&#8217;ve done nearly all of it (with the exception of a small
bit of scripting for auto-download) in pure hypermedia. And it only took about 16 lines of front end code and 16 lines
of backend code to build the whole thing, showing once again that HTML, with the help of htmx, can, in fact, be very
expressive.</p>
</div>
</div>
<div class="sect2">
<h3 id="_summary_6">9.5. Summary</h3>
<div class="ulist">
<ul>
<li>
<p>In this chapter we built a sophisticated user interface to interact with a non-blocking, asynchornous back end process</p>
</li>
<li>
<p>We saw a two different ways to do polling in htmx, both "indefinite" polling using the <code>hx-trigger</code> attribute and a
technique called "load polling"</p>
</li>
<li>
<p>We settled on using "load polling" for our situation, since it had a definite end point after which we no longer wanted to poll</p>
</li>
<li>
<p>We saw how the htmx swap mechanism enables CSS transitions when an element has a stable ID in new pieces of content,
and we used that to smooth out the progress bar in our application</p>
</li>
<li>
<p>We used a bit of hypermedia-friendly scripting to trigger an auto-download when the archive progress completes</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="paragraph nav-footer">
<p>← Previous: <a href="_building_hypermedia_systems_3.html">Building Hypermedia Systems</a> | ↑ Up: <a href="_building_hypermedia_systems.html">Building Hypermedia Systems</a> | ⌂ Home: <a href="BuildingHypermediaSystems.html">Building Hypermedia Systems</a> | Next: <a href="_building_hypermedia_systems_4.html">Building Hypermedia Systems</a> →</p>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2022-10-20 12:44:43 -0600
</div>
</div>
</body>
</html>